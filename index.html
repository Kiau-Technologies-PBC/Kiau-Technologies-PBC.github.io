
<!DOCTYPE html>
<html lang="en">
<head>
    <!--Edited by Max Van Dorn -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <title>Kiau Technologies</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        /*TODO:
          - Add in roots growing off of nodes
          - Develop more fleshed out content for pages
          - Add photographical data
          - Create a log in page
          - Connect to a DB using sql
          - More...
        */
        :root {
            --background: #f9f5f2;
            --primary-color: #145b4f;
            --accent-color: #da99d6;
            --background-color: var(--background);
            --text-color: var(--primary-color);

            /* Graph palette (single mode) */
            --node-color-day: #0fff95;
            --link-color-day: #06ba63;
            --day-background: var(--primary-color);
            --text-fill-color-day: var(--background);
            --text-stroke-color-day: #1b4a42;

            font-family: 'OCR_A', Arial, sans-serif;

        
        
            /* Values for desktop default*/
            --link-distance: 350;
            --node-radius: 6;
            --stroke-width: 3;
            --font-size-normal: 22px;
            --font-size-special: 28px;
            --boundries-padding-width: 250;
            --boundries-padding-height: 50;
            --wave-count: 30;
            --wave-amp: 60;
        }

        /* Tablet breakpoint */
        @media (max-width: 1024px) and (min-width: 769px) {
            :root {
                --link-distance: 270;
                --node-radius: 5;
                --stroke-width: 2.5;
                --font-size-normal: 18px;
                --font-size-special: 23px;
                --boundries-padding-width: 150;
                --boundries-padding-height: 30;
                --wave-count: 20;
                --wave-amp: 40;
            }
        }

        /* Mobile breakpoint */
        @media (max-width: 768px) {
            :root {
                --link-distance: 180;
                --node-radius: 3;
                --stroke-width: 1.4;
                --font-size-normal: 12px;
                --font-size-special: 16px;
                --boundries-padding-width: 60;
                --boundries-padding-height: 5;
                --wave-count: 10;
                --wave-amp: 10;
            }
        }

        /* Small mobile breakpoint */
        @media (max-width: 480px) {
            :root {
                --link-distance: 140;
                --node-radius: 2.5;
                --stroke-width: 1.2;
                --font-size-normal: 11px;
                --font-size-special: 14px;
                --boundries-padding-width: 40;
                --boundries-padding-height: 3;
                --wave-count: 8;
                --wave-amp: 8;
            }
        }

        .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        margin: -1px;
        padding: 0;
        border: 0;
        clip: rect(0, 0, 0, 0);
        overflow: hidden;
        }

        /* Welcome Popup Styles */
        .welcome-popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-in;
        }

        .welcome-popup-overlay.fullscreen {
            background-color: transparent;
        }

        .welcome-popup-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .welcome-popup {
            background-color: var(--primary-color);
            border: 3px solid var(--accent-color);
            border-radius: 10px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.4s ease-out;
        }

        .welcome-popup.fullscreen {
            width: 100vw;
            height: 100vh;
            max-width: none;
            max-height: none;
            padding: 0;
            border: none;
            border-radius: 0;
            background: transparent;
            box-shadow: none;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        @keyframes slideIn {
            from { 
                transform: translateY(-50px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }

        .welcome-popup-close {
            position: absolute;
            top: 15px;
            right: 15px;
            color: var(--accent-color);
            background: transparent;
            border: none;
            font-size: 24px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-family: 'OCR_A', Arial, sans-serif;
        }

        .welcome-popup-close:hover {
            background: var(--background);
            transform: rotate(90deg);
        }

        .welcome-popup h2 {
            font-family: 'OCR_A', Arial, sans-serif;
            color: var(--background);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 28px;
            text-align: center;
        }

        .welcome-popup-content {
            color: var(--color-4);
            font-family: 'OCR_A', Arial, sans-serif;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .welcome-popup.fullscreen .welcome-popup-content {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            background: transparent;
        }

        .welcome-popup-content p {
            margin: 10px 0;
            font-size: 14px;
            color: var(--background);
        }

        .welcome-popup-graphic {
            width: 100%;
            max-width: 400px;
            height: 250px;
            margin: 20px auto;
            display: block;
            border: 2px solid var(--color-2);
            border-radius: 8px;
            background-color: #1b4a42;
            overflow: hidden;
            transform-origin: center;
            transition: transform 0.35s ease, opacity 0.35s ease, height 0.35s ease, margin 0.35s ease;
        }

        .popup-graphic-hidden {
            opacity: 0;
            transform: scale(0.82);
            height: 0;
            margin: 0 auto;
            pointer-events: none;
        }

        .popup-graphic-show {
            opacity: 1;
            transform: scale(1);
            height: 250px;
            margin: 20px auto;
        }

        .popup-graphic-window {
            opacity: 1;
            transform: scale(1);
            height: 60vh;
            max-width: 90vw;
            width: 90vw;
            margin: 10vh auto;
            border: 2px solid var(--accent-color);
            background: transparent;
        }

        .welcome-popup-link {
            display: inline-block;
            background-color: var(--accent-color);
            color: var(--color-3);
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 5px;
            font-family: 'OCR_A', Arial, sans-serif;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px auto;
            display: block;
            text-align: center;
            width: fit-content;
        }

        .welcome-popup-link:hover {
            background-color: #1b4a42;
            color: var(--color-4);
            transform: scale(1.05);
        }

        /* Popup slideshow helpers */
        .popup-slide-text {
            color: var(--background);
            text-align: center;
            margin: 10px 0 6px;
            font-size: 13px;
            line-height: 1.5;
            min-height: 42px;
        }

        .popup-text-large {
            font-size: 22px;
            line-height: 1.6;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .popup-text-normal {
            font-size: 13px;
            line-height: 1.5;
            min-height: 42px;
            display: block;
        }

        .popup-slide-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .popup-btn {
            background: var(--accent-color);
            color: var(--background);
            border: none;
            border-radius: 6px;
            padding: 8px 14px;
            font-family: 'OCR_A', Arial, sans-serif;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        }

        .popup-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }

        .popup-btn:hover:not(:disabled) {
            transform: translateY(-1px);
        }

        /* Slide visuals */
        .pop-node { transform-origin: center; transition: transform 0.4s ease, fill 0.3s ease, stroke 0.3s ease; }
        .pop-node.pop { transform: scale(1.08); }
        .pop-link { stroke-dasharray: 180; stroke-dashoffset: 180; transition: stroke-dashoffset 0.6s ease; }

        /* Mobile adjustments */
        @media (max-width: 768px) {
            .welcome-popup {
                padding: 20px;
                max-width: 95%;
            }

            .welcome-popup h2 {
                font-size: 22px;
            }

            .welcome-popup-content p {
                font-size: 12px;
            }

            .welcome-popup-graphic {
                height: 180px;
            }
        }
    </style>

</head>
<body>
    <!-- Welcome Popup for First-Time Visitors -->
    <div class="welcome-popup-overlay" id="welcomePopup">
        <div class="welcome-popup">
            <button class="welcome-popup-close" id="closePopup" aria-label="Close welcome popup">Ã—</button>
            <div class="welcome-popup-content">
                <svg class="welcome-popup-graphic" id="popupGraphic"></svg>
                <div class="popup-slide-text" id="popupSlideText"></div>
                <div class="popup-slide-nav">
                    <button class="popup-btn" id="popupPrev" aria-label="Previous slide">Previous</button>
                    <button class="popup-btn" id="popupNext" aria-label="Next slide">Next</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="screenReaderMessage" class = "sr-only" role = "status" aria-live = "polite" role = "alert">
        Welcome to the Kiau Technologies website, this text is only read by screen readers. Use tab to navigate through the options of the menu. Each item is a link to a website and will be read twice, please bare with us while we fix this problem. Press enter when you hear the desired option. 
    </div>
    <div class="fpsCounter" id="fpsCounter" aria-hidden="true">FPS: 0</div>
    <div class="cookieNotice">We do not collect cookies or data about you on our website!</div>
    <svg id="mainGraph"></svg>
      
    <script src="fps.js"></script>
    <script>
        // Welcome Popup Logic
        function initWelcomePopup() {
            const popup = document.getElementById('welcomePopup');
            const closeBtn = document.getElementById('closePopup');
            // Always show popup on load
            setTimeout(() => {
                popup.classList.add('active');
                createPopupVisualization();
            }, 500);

            // Close popup handler
            function closePopup() {
                popup.classList.remove('active');
                // Reset fullscreen/window state if it was the last slide
                popup.classList.remove('fullscreen');
                const popupContainer = document.querySelector('.welcome-popup');
                popupContainer?.classList.remove('fullscreen');
                const overlayEl = document.getElementById('welcomePopup');
                overlayEl?.classList.remove('fullscreen');
                const svgEl = document.getElementById('popupGraphic');
                if (svgEl) {
                    svgEl.classList.remove('popup-graphic-window');
                    svgEl.classList.remove('popup-graphic-show');
                    svgEl.classList.add('popup-graphic-hidden');
                    while (svgEl.firstChild) svgEl.removeChild(svgEl.firstChild);
                }
            }

            closeBtn.addEventListener('click', closePopup);
            
            // Close on overlay click
            popup.addEventListener('click', function(e) {
                if (e.target === popup) {
                    closePopup();
                }
            });

            // Close on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && popup.classList.contains('active')) {
                    closePopup();
                }
            });
        }

        // Slideshow for the popup mini-graph
        function createPopupVisualization() {
            const svg = document.getElementById('popupGraphic');
            const textEl = document.getElementById('popupSlideText');
            const btnPrev = document.getElementById('popupPrev');
            const btnNext = document.getElementById('popupNext');
            const overlay = document.getElementById('welcomePopup');
            const popup = overlay ? overlay.querySelector('.welcome-popup') : null;
            if (!svg || !textEl || !btnPrev || !btnNext) return;

            const width = 400;
            const height = 250;
            const svgNS = "http://www.w3.org/2000/svg";
            svg.setAttribute('width', width);
            svg.setAttribute('height', height);
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            const baseNodes = [
                { id: 'Kiau Tech', x: width/2 - 80, y: height/2 + 10 },
                { id: 'Projects', x: width/2 + 60, y: height/2 + 10 },
                { id: 'Systems', x: width/2 - 10, y: height/2 - 60 }
            ];
            const baseLinks = [
                { source: 0, target: 1 },
                { source: 0, target: 2 }
            ];

            const slides = [
                {
                    text: "Welcome!",
                    draw: () => {
                        // No SVG shown on this slide
                        svg.classList.add('popup-graphic-hidden');
                        svg.classList.remove('popup-graphic-show');

                        textEl.classList.add('popup-text-large');
                        textEl.classList.remove('popup-text-normal');
                    }
                },
                {
                    text: "This is a node. It represents a page on our website. Each page covers an important topic for us.",
                    draw: () => {
                        svg.classList.remove('popup-graphic-hidden');
                        svg.classList.add('popup-graphic-show');

                        textEl.classList.remove('popup-text-large');
                        textEl.classList.add('popup-text-normal');

                        const n = baseNodes[0];
                        const circle = document.createElementNS(svgNS, 'circle');
                        circle.setAttribute('class', 'pop-node pop');
                        circle.setAttribute('cx', n.x);
                        circle.setAttribute('cy', n.y);
                        circle.setAttribute('r', 18);
                        circle.setAttribute('fill', '#0fff95');
                        circle.setAttribute('stroke', '#1b4a42');
                        circle.setAttribute('stroke-width', '3');
                        svg.appendChild(circle);

                        const label = document.createElementNS(svgNS, 'text');
                        label.setAttribute('x', n.x);
                        label.setAttribute('y', n.y + 34);
                        label.setAttribute('text-anchor', 'middle');
                        label.setAttribute('fill', '#f9f5f2');
                        label.setAttribute('font-size', '13');
                        label.setAttribute('font-family', "'OCR_A', Arial, sans-serif");
                        label.textContent = n.id;
                        svg.appendChild(label);
                    }
                },
                {
                    text: "This is a link, connecting two nodes sort of like a vine. Displays interrelated topics.",
                    draw: () => {
                        svg.classList.remove('popup-graphic-hidden');
                        svg.classList.add('popup-graphic-show');

                        textEl.classList.remove('popup-text-large');
                        textEl.classList.add('popup-text-normal');

                        const n1 = baseNodes[0];
                        const n2 = baseNodes[1];

                        const line = document.createElementNS(svgNS, 'line');
                        line.setAttribute('class', 'pop-link');
                        line.setAttribute('x1', n1.x);
                        line.setAttribute('y1', n1.y);
                        line.setAttribute('x2', n2.x);
                        line.setAttribute('y2', n2.y);
                        line.setAttribute('stroke', '#da99d6');
                        line.setAttribute('stroke-width', '5');
                        svg.appendChild(line);
                        requestAnimationFrame(() => { line.style.strokeDashoffset = '0'; });

                        [n1, n2].forEach((n, idx) => {
                            const circle = document.createElementNS(svgNS, 'circle');
                            circle.setAttribute('class', 'pop-node');
                            circle.setAttribute('cx', n.x);
                            circle.setAttribute('cy', n.y);
                            circle.setAttribute('r', 16);
                            circle.setAttribute('fill', idx === 0 ? '#0b1220' : '#0b1220');
                            circle.setAttribute('stroke', '#0b1220');
                            circle.setAttribute('stroke-width', '3');
                            svg.appendChild(circle);

                            const label = document.createElementNS(svgNS, 'text');
                            label.setAttribute('x', n.x);
                            label.setAttribute('y', n.y + 30);
                            label.setAttribute('text-anchor', 'middle');
                            label.setAttribute('fill', '#0b1220');
                            label.setAttribute('font-size', '13');
                            label.setAttribute('font-family', "'OCR_A', Arial, sans-serif");
                            label.textContent = n.id;
                            svg.appendChild(label);
                        });
                    }
                },
                {
                    text: "This is the network: nodes are topics, links are how they connect.",
                    draw: () => {
                        if (overlay && popup) {
                            overlay.classList.add('fullscreen');
                            popup.classList.add('fullscreen');
                        }

                        svg.classList.remove('popup-graphic-hidden');
                        svg.classList.remove('popup-graphic-show');
                        svg.classList.add('popup-graphic-window');

                        // Clear inline SVG so you see the page behind
                        while (svg.firstChild) svg.removeChild(svg.firstChild);

                        textEl.classList.remove('popup-text-large');
                        textEl.classList.add('popup-text-normal');
                    }
                }
            ];

            let current = 0;

            function renderSlide(idx) {
                current = Math.max(0, Math.min(idx, slides.length - 1));
                // Reset popup/window state for non-final slides
                if (overlay && popup) {
                    overlay.classList.remove('fullscreen');
                    popup.classList.remove('fullscreen');
                }
                svg.classList.remove('popup-graphic-window');
                svg.classList.remove('popup-graphic-show');
                svg.classList.remove('popup-graphic-hidden');

                while (svg.firstChild) svg.removeChild(svg.firstChild);
                slides[current].draw();
                textEl.textContent = slides[current].text;
                btnPrev.disabled = current === 0;
                btnNext.disabled = current === slides.length - 1;
            }

            btnPrev.onclick = () => renderSlide(current - 1);
            btnNext.onclick = () => renderSlide(current + 1);

            renderSlide(0);
        }

        function loadGraph() {
            const scriptElement = document.createElement('script');
            scriptElement.src = "nodes.js";
            document.body.appendChild(scriptElement);
        }

        function resizeSVG() {
            const svg = document.querySelector('#mainGraph');
            if (!svg) return;
            
            const width = window.innerWidth;
            const height = window.innerHeight;
    
            // Update SVG size
            svg.setAttribute('width', width);
            svg.setAttribute('height', height);
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            // Adjust force simulation (distance and center)
            if (window.simulation) {
                const linkDistance = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--link-distance'));
                window.simulation
                    .force("center", d3.forceCenter(width / 2, height / 2))
                    .force("link", d3.forceLink().distance(linkDistance))
                    .alpha(0.3)
                    .restart();
            }
        }

        // Apply mode on page load
        window.onload = function() {
            loadGraph();
            resizeSVG();
            initWelcomePopup();
        };

        // Debounced resize handler
        let resizeTimer;
        window.onresize = function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(resizeSVG, 150);
        }

    </script>
    
</body>
</html>